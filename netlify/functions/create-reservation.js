const fetch=(...a)=>import('node-fetch').then(({default:f})=>f(...a));exports.handler=async(e)=>{try{if(e.httpMethod!=='POST'){return{statusCode:405,body:'Method Not Allowed'}}const d=JSON.parse(e.body||'{}');if(!d.datetime||!d.people||!d.phone){return{statusCode:400,body:'Missing fields'}}const url=process.env.SUPABASE_URL+'/rest/v1/reservations';const r=await fetch(url,{method:'POST',headers:{'apikey':process.env.SUPABASE_KEY,'Authorization':'Bearer '+process.env.SUPABASE_KEY,'Content-Type':'application/json','Prefer':'return=representation'},body:JSON.stringify({datetime:d.datetime,people:d.people,phone:d.phone,comment:d.comment||null,created_at:new Date().toISOString()})});if(!r.ok){const t=await r.text();return{statusCode:500,body:'Supabase error: '+t}}const j=await r.json();return{statusCode:200,body:JSON.stringify(j[0]||{})}}catch(err){console.error(err);return{statusCode:500,body:'Server error'}}};